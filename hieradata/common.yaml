---
classes:
  - apt::unattended_upgrades
  - govuk_apt::unused_kernels
  - gds_accounts
  - harden
  - puppet
  - ssh::server
  - ufw
  - gds_sudo
  - nginx
  - mirror_environment
  - mirror_environment::cron
  - mirror_environment::fail2ban
  - mirror_environment::firewall
  - mirror_environment::mounts
  - mirror_environment::user
  - mirror_environment::clamdscan
  - mirror_environment::supported_kernel
  - mirror_environment::nrpe
  - resolvconf
  - rssh
  - clamav
  - nrpe

apt::unattended_upgrades::auto_reboot: true

puppet::puppet_ensure: '3.2.3-1puppetlabs1'
puppet::facter_ensure: '1.7.2-1puppetlabs1'
puppet::cron_command: '/opt/puppet/tools/puppet-apply --environment %{environment}'
puppet::cron_ensure: 'present'

mirror_environment::package_array:
  - lvm2
  - rsync
  - curl
  - update-notifier-common

rssh::users:
  - 'mirror-rsync:022:100000'

nginx::server_tokens: 'off'
nginx::confd_purge: true
nginx::http_cfg_append:
  gzip_vary: 'on'
nginx::nginx_vhosts:
  'www-origin':
    server_name:
      - 'www-origin.mirror.*'
    www_root: '/srv/mirror_data/www.gov.uk'
    listen_port: 443
    ssl:      true
    ssl_key:  '/etc/nginx/ssl/mirror.key'
    ssl_cert: '/etc/nginx/ssl/mirror.cert'
    ssl_protocols: 'TLSv1 TLSv1.1 TLSv1.2'
    location_cfg_prepend:
      expires: '15m'
      error_page: '403 500 503 504 =503 /error/503.html'
      rewrite: '^/(.*)/$ https://www.gov.uk/$1 permanent'
    try_files:
      - '$uri/index.html'
      - '$uri.html'
      - '$uri'
      - '=503'
  'assets-origin':
    server_name:
      - 'assets-origin.mirror.*'
    www_root: '/srv/mirror_data/assets.digital.cabinet-office.gov.uk'
    listen_port: 443
    ssl:  true
    ssl_key: '/etc/nginx/ssl/mirror.key'
    ssl_cert: '/etc/nginx/ssl/mirror.cert'
    ssl_protocols: 'TLSv1 TLSv1.1 TLSv1.2'
    location_cfg_prepend:
      expires: '15m'
      error_page: '403 500 503 504 =503 /error/503.html'
    try_files:
      - '$uri'
      - '=503'

nginx::nginx_locations:
  'canary':
    vhost: 'assets-origin'
    priority: 900
    location: /__canary__
    location_custom_cfg:
      - 'default_type text/plain'
      - 'add_header cache-control "max-age=0, no-store, no-cache"'
      - 'return 200 "Mirror OK\n"'

mirror_environment::supported_kernel::hwe_ver: 'trusty'

mirror_environment::mounts::mirror_data: '/srv/mirror_data'
mirror_environment::mounts::username: 'mirror-rsync'

mirror_environment::user::username: 'mirror-rsync'
mirror_environment::user::ssh_key: 'AAAAB3NzaC1yc2EAAAABIwAAAQEAw/ksvUhzrUVVbupDXEwz4J2K8Yz515pxhRLpfx6oGruM/hj4wVJ5uPt+4IL5k0sLXxRH0X/VXuK2zBV2fSnPP4cNUZiFrPbN1gea945dGvGIstLMZfsw8Md3jN4i8UXZFBriUfjQT7APLGEsQ+fl+Lzuhpp1nq2oWKem28moAxQkxU2ShPQhP/kzRkTrNbiusOFE4YQN4seZRJEtZ22p+qSVAPVyc2mfJHr6gdVNO3dMBdD7Ud9m3L5AeD7GNA/r2DiJViIplipRMvJJ0w3KkCnTWHiw3C0tXjyAMIH3jXqIJVqUej7Jum3FzixQrFgBR88XkPzlR0qHvR73HBSeZQ=='

gds_sudo::sudoers:
  group_sudo:
    users: '%sudo'
    tags:
      - 'NOPASSWD'

gds_accounts::groups:
  - gds
  - sudo

gds_accounts::accounts:
  alexmuller:
    comment: Alex Muller
    ssh_key: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCdvvlsypohk8GO/OVu6oTpJMBf+uxhpdk6yjd7cELgD2wrLQKggMCLRzi+04WcLoU8YE/SuEd8fwiwvhi+wauRKCkCnkuHQzexA30cLqWpkjbzZzFiEp76cBevbR/btFKWAc8suxhxGQp4i90QjsAdIuEY230cpUURbGW1JRdhfF9n6nQ5HVWyZ6Q/0PqzJvB8k2GNcPGYqmPW7V3aW0FteEvf3a27K30dUkOomUJGtXiJxkAe81aovxGcLwhBFiKrof35+qGylTlgh/XMcdjxdBstUbEBxi0RzNycFGJnwacrolLnn0Zsm5dLfi0nLCXgK7yxGFI8xoJOdb4GBKvMiDtM5qHnE3grIXjjpmYZfEvY/pbXA7PBjhIs2GfS7YAPDDOWV+fME1+UQssd9dz1kzlej6+bg/9z/hHdWylN+G3cAC4pRNHhvZUUvOTVjCM18KZdRLzIO8BPADxUDLqcUznR/x8jeAMZs5L0TvBQcnZsrBnm2gplPmzhh0OYGdlgzDzDPmR2LBKyiCQCxANEW7Z4alJRjRHoq2dx9BawUWBsHFJ9JexDLE2XvkRA1vqhQSQTsWn4eM/PnUUiSxTTh2fVme9SC9rwL0NN1VB8n4CCLxOU9EMLRTvVawR2pNlDeiowDiVT1Fpe1NCUAlVkGkJP9h5/GupYt2ufXQn2ZQ== alexmuller@gds0386.local
  bob:
    comment: bob walker
    ssh_key: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDiocsYQ5QyshThjdfgaYNp9byopWa1Qlhr956pE5JqwD6fLuC9msEfDU426gNQmR+XneUFaONgzfHXv33WbKnb1e+ccUTV4MmmfEIXZzhwtjwJyROEJ3DbPrOWmwWZr3BChmw9OQ537kXIeNQ9VFqo7vWXlYEAlsU0J//P0WWkKb23zmi8GkG/lIZ/bWpj92SHVMKXAfurFMV1EBn5QBdHOdJfh6mzb/CiZpQ+bPstUNF1UJG02twkAqVehPfSKfwdjmrmRwA8UQeTEyHfDgUZt/Mq4SN5uWwBS3lXS/bV1sc5bDbLDM43gzwRLrN2uNAW3jgRz5BbqH03SOwoY1CjSPmFrxQ1X62QO8Dc8IHxXF8y5+wNEeLsH/Ev8E0W6Ds0KHMQpoNDnTdQ6vPblgsiHGpT0zIn7VOG+GqJHS/LoZy3V9JeeJ7n9sqhQ2CQRISyyJLhHoK5W278bWMRUlYX2MV7NRhmOfSSYiTY1uegzqSgH38Io2EaIUC/jgcCyqf4vDTG9U/0WnYE2H7HEeNtk8w1C3//B8EWY43JXMQT1suUryIjNvONa3j3rTmvMkldxpCktRuK7LKLTHuh1Ls/KIY7MlbS9BqkpaKO06UnutvOpNJ0hz7T8KiQwb49ENfgQQPrb5q5GiD8DIW3YgB/duOmvrU+xUDUvIjgmkHKow== bobwalker@GDS479.local
  bradleyw:
    comment: Bradley Wright
    ssh_key: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDTlc6MBQDXSkT5EdzxbuU1tEEwMlK8YZ/H8JSKSNlBdiCBlPj+puWDLzlFze1vSswRAgBgzct0dEFZgowcmvigDHAvfTIxJujlzpYWaztOCoYbqeuhDl2+ey8Ogwzow4oVdMrw70hLGlskbPveGiSEURqcV+6fW1ugaqPUSu3x5YOLhzuxjLEb/x0yVUOB9b+AE0crGNN57sYToPr+bJcZNl61OkVx+yaV17HQTOwt+uZ4gMX4VzHzwO3aClJ1rsSbbYtH/aZzsu8djEdSQZIMZQmbSMf4zJNl3yMN72lkbO8BZlj9zNtHh3PhxnC2YWX6iX7nEq1KMIKPCj/QK0hCccgvd/a1Y7qZqo2I+yBl+AUjTACOgoiEjCZ6IFfhcxuB8E2ZogwBquaR8R8lYKAwq6tcHj6XDMLCszuge3etlYomG7k8Nmgbxg2AgjnGsywpOiXPAmmCZaX/YsYH6y5/2NeJunXl/1d1POnezuVgIUnUONyWe+4DTFsMOhNRuexWXEX5zjJqT9mHli3KoYmQBPddoEJEN+qac7bL0y65El3aWks3Cl+m5Kk94+vf94RWrPL+9t9DOXj/RFE4VzyrvumRiDIB7guZl4XdGgwP3iKI7ajgCFUjD7AMGjLpvy7FwkXiSR6+SF61IX+MYeb6HKoMpV77AJA6dsQPD6KY5Q==
  daivaughan:
    comment: Dai Vaughan
    ssh_key: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC2UL9m1ukdh0gZUoBOuGfNL9aZJ64gGa0Wn94a3owZxvfFHpb0cuuYb2EvyOt4tjpaKucAXRs+2nW+892p+wbwSerf26V6q8MgM0LbsDcXOkI8dqhx/HBZ9W6d3xpBdF/f1W3sKrKVvaVCZC6CrRplaPdDwPr/N9FF/qf4mRO5gCN7cP530F6uJnPj7tUKdIrkgWY8CMxhpF6uEFZTRdRJPUsKratS2k0w7woF09TqMngJuIfu+OFDJTm3VnIbn3zdgqJSWIO9RQFHOBg9SCSotNWetQfcaS4f8WJJy6/IFir0i05izy1f6PQPIxI9SbgiERp2G7UaOGtBGRePGluFxYnrZZxfRqlg41FeCeH2mKn/EKdwOSY/9gzWN4QQKKNPNaCoJxKo4QCI1225HPQgGfHH8V2fHgRf3lsgwWsnQUOWZi2KvjwTyO+qPNyj5sxVSt7o2B1l41bh7COqivc9MVvl7SqQK1VARQtoyLwxjjlG+Xgo2OfNB2OqCxn5UuSJpI6fQYhOFM3LYeSixVpK3t9WBqCi9bKEOx0lO1tzcXyES4rZDZNjyvJ3W0C6OkisMIeCArvQ+vI/d5FaUUhHeATS8C5Awe7/joq5OOn46hMDa93RW7WRrH5m5JddlraK3Pa6S1GvuTtpMZTSg32bXIK9zq+kmhhLjCQRU3yJAQ== dafydd.vaughan@digital.cabinet-office.gov.uk
  danielroseman:
    comment: Daniel Roseman
    ssh_key: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDcz+lw8fLHK2IHyIOs4w29QO0zT6I98l0m5JrapSsK9ZUASS2svj7EvinMdJJ2NQQ4fqhYMD67xB2gzhug/SEpYpIicg3aUDdQEJyQulWLigH9rRFYjFv5d6jkFkRUHc4XRd31PFc6tjTgpstzPaL1uO20XlDIaU1U2+LyUplENVkVtTuNqyVPfg8qjtzHGWswr16E8ouKtfzAuTAmkuVS19cjXiflSuXD5v8vXsVzpNbyoXDjoeu443ZY8MOavZMD/7ClrZd43m/Yi154I42xJ68uM+3R4uuU6OQgcOnNhwRnyJ21jFk7ohnipVmTxB5oUjXuh0gPQSfOkCQPvddwsd/0dmfLEKidAIrwcUllI0qngSjkei0M693Wn9zJmdYoyOTpksCpEsmSpeF5ALYOXedlZfa6WuJu7SxozfuaQScJONu5TZbIS5mM/1zRVwB15cdZ+qgH1WCG9wjFWTH3CerqfnMxqpB80nxHcKD6r/FJ7tRVpHY9CaW9iAjZ97d7Hh6MTb8Jksg1F0os0c/hSOChFX/hJpmeGnQIEdu4hE7U/zt7gVxalx6446BOPdDePDcPae8ngQAutRDNI6/MtL0QAcxDUEnW2KD9QVatvwEh3kdta+EJBUOiWAjEBlpMa34509mBI1H8JKa3wAxpQ0u9tzIzsXzoxsYiUPjXkQ== daniel.roseman@digital.cabinet-office.gov.uk
  jamiec:
    comment: Jamie Cobbett
    ssh_key: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDJHyDmfrVBot/8xcAwPLv5uHRpvRy13iNWYW0FGPol7hgcrr0CAESK+cYD7LaW9PmX9dR0X65tAhp4nZydmiBKjfcoMKOcMELxKNNoOzMnd0vDI6emG+ldD0UPZsZwMvYzfYLw7ZaFTPlK/EHZe7/zQ84PKVvtV16LKn17sP6Y9DgizcrctUSbjwmLtwBhLaAptq4wyqeJANQf9D/4jyvrTPyDGkZ40cl6XiTcTzXBPUkdTVA2r66c+sg08YgOgCBK3iysm6yKadd0xrfWKvBnin6ZAClyjJnJ35gZxpVRbczvSOmwiY8EkiCzbgFyoGIRUyUBUfifWoE8BYMK8aF8uQPvAvdkb4bkfcTiQTT3LmL8WlRqosGqmctMwyHaa/o+HNMpsGMeB0s/uVCRcnspuoJV/JHf+61UUeJP7PhwefBnMozqdJqjJSFRP1lhONUwUQR3zRh0BwkkyA+/TxYnByhLwkRiPe//O/DMlSZqW8EH59aiZUOsbkOz/WxolpgNg82WSE6fzk5WLTMuWZNRJuJOv7Bj9N142lJCCN8jowP+dnm3MDN/I8sIf1We4D/VFRoeMbbs1DBf+N9WQrpGABEKbMeKivOkTT/AYVa6dsqb3zRG0QxiJfELVDGlSE62/c5h+PaABIuvxWLERbz32TS3iCjtw383BnWKhcbAKw== jamie.cobbett@digital.cabinet-office.gov.uk
  jennyduckett:
    comment: Jenny Duckett
    ssh_key: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCtChH/aBoCbgossPnUCUUhdSNah/dBZqqbFV4zDY+kvdB4N73nt3yGiQnLRp/9aI2oHI046coN+fDaNIcaJcLLXxqavZEazP/xZab0zDez/yvxGGPeHdi1iMEGg0EpWjKKHhvONWgsGAkHLObIzrcU9+GRcyn68CeS44hHuGy4LQ6fYVsi5iCXziGpJCTND13gK2rpl1tnr72G+dJtTRA120eO/2ZM4EWQpbI1RpTcBDABIBa22SNM76lazNiVDcPG88igP9QPDlAGQSXXIz573K61M+Gtm+jGyWnD9Hj+G3u1tQ2UAC+D5Mc5p6B/cDYHUoEQgcIwm3yuTJPSJMyKy/u2dCMmvRhr7rCMBYfWt6mprQKubYw64lGVItpPswXujmSWmUqHILCMY4Daqt9jHOe/cabjEEyrtqxWPj4JjC+lUpX7aoMfHmNqVi84P/E+0z+eA5cL+4wbeeJYeHhicXOQl2Z2NcmKBU/kOEoLO1GeO1w+2GdMQQt1SpAiHflBnvKo9HcrHZVaRzWH/VPehfiQcwjiWD/lpTRnr570nM8NudgxQOtaV4vewM8VNrT88E0IL4uorO/g7FiY2d5KV/g+Gvre5zsCBWObAze8O1/h0itcJ0zzBJ+BVgvOAMUrL7V0pYjKkmsXVTIXXcL8iZXClz7Q8kmYB3Be0qKbdw== jenny.duckett@digital.cabinet-office.gov.uk
  mattbostock:
    comment: Matt Bostock
    ssh_key: AAAAB3NzaC1yc2EAAAADAQABAAACAQDBc1Tcz6UiZoCnQCadVCSuJT9UXu0sf/duILN5epB2s0jL1uB8rKjT+RrpstZAr5YIN3Gm2IpTlTAxftNyDnxH5SqFYt4lLG+ibCxGffUYdJt0RCc4Atgh7VJDtLiwLbH1iaAVCipV8SevkcbT1BaBymsIPqy76XtuI46ENTbT23wW9a3F6j43M0TMzjFsTVy4dagSkkpb3V47E26jik/rcVL43lZNyaLBx/Nn/4bdGjZw6LfjyTAyE//xTvK5I6dYLFF4hH9IwC59Hs532q73YjXsEey4hf+mPjZWjirIJdyisXyK4E1LfKTqQoqOd2mMiPlK15pkDkHc1DnZTv8AZCgWNf87li2GIAsuB62bR76Umg7U49J+hFN6TSs8kLB+QJg83BBnKUb4lJj49BCGg7VP6xx7VIuG6ir/WROmN33miKpYBE8NYZb1t7W/CeglcfA3eZh+ZZAvQ8AUDh7WHvxqr0L5UQuuVCtO4pJV0OyKorLM/5TYh++CKr0Z+EZAVK3WsB+EIPbT9lNy0FrY40GAfE2Ud4uW5P20afYnd+f2TfBotRC6EHtM8guqO8JoFUqWTCgcyQyEe3f4zR5x7jseGyb/hL+dOPgfw3WNVYdLKNQx9weEjRAVhlzfDOrfOXEdPoaOYKmtWd2i4yM0/wblxOQnxI4rZbo1KWBx2Q==
  richardboulton:
    comment: Richard Boulton
    ssh_key: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCz/YV16q+dQQlXReLyS9mDVl36NlIs6iwZjbGQbLnuz1pb5GrHn8Adnvr50bHZncCtbMa0FlCpeiKGfcGCiDeQLYx1laCeNaD94OSeRYdjoVJiw6bpM7oc06YMaveMlD/z1K+XPbWx78Wx4TzezVhvO3+frVqe1w+0Z8olyLJW84c0FLlssBye6wG5dd/ZA/Vjj3dEA7qSgcRNeishedj62aVmvBYgwl95AHCH2dknmPMGmgWDdg+Rv6qR1F309XP4iwHgPCX+vllxFENZi1SQdekJw+sMTtcat10G6C9fmK6Cm6P+Xk5hcG5MzoQOB4YcC5wUCGPX0NiJxov0kvSoHDwxsjiZJG+ktGIUkmAYX/t+lbVhJbjJfU3XOkHUAe4RteqjTDKxw8LCNqIw1AHGJ9A1Ny5+JNt9cj60pKF75G5Iek2y5mrCQSxg4Bo8zloS7IaOhuU+9shT3d7BuaFkfV01FIt7WZPyNhtBACyac9+zIMd/9MFFNLlh8NLLoi/LK6IYlArfcORr4vzkMG7BNfcR1yj6NoissbffnfpzVZryfOChWPDk3lfXp5SOwEaktZYZ6gtjCXE9Soy5Kqdf/FV1TMwgzbR6egwV+PrB5Iy0+1GkNwY/4fmU89+URfTQw/HmRDrnGaPeEYCeCDZesfJVC3u9o+yKXZCoys6dpw== richardboulton@GDS0322
  tombooth:
    comment: Tom Booth
    ssh_key: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCXsr6ArkA8+cJaTBUnsdUmWbXevETDpJjwkIpG0QK7HsvVNZrTUbBqCnkq3S9RGmqwDEDomV6lwl6mcT7jfnX4t156l+lPGb6Bc3NLLLvzp5ezTM/HuCbsWrmppZeBV4u1rEOPB3mW97P1lm548LUVeb0lQmsR14VmHVHbTk+kQNRWn1Qw9eRAcoYfJZVFl3B2Gz4S/ASMm7ZkIRnaTmcZg4Pqu8n9fOpQLBF3bql1TZ/EWuQzt3FD2cFf/LsolxSd8Q7USsROkRCb9JnUAovxlMd5ac83aMgURVswzxq1CM6E042XmOMswjCZI1/ZRx2jJogH1UMeueXguZxvjYBbD3ixomtLW+4fsWCXg2dLgzZmGZAZIP619Gkqg2pCKDXRYpx0j2TmscJ53dUf9v1NU5vDThz4yCRN1o071ZSd4uBwonPvHINK3yOHOY7EnM/HjQnQQAFhdZiXKSJiOUM14bRH8vCsMYxr9ZJH3EDAR3U0Kra/uCnVjNGo5E7QS9BO+BOx8UBjE+RBOPNLSDvh1oDtnXNHULBntlXcJimtub/Z77ljnMDU8nPlacvKgCZFdsr5vxvIsvz0HT4U5ccSKABQNHkSdPYmOT0yCWolpHbIhjlt49NiFTCNqka951J9ygR9Tw4ptBOSNVEKp52iY2Y5qvxMjGx0uKZkXPcNyQ== tom.booth@digital.cabinet-office.gov.uk
