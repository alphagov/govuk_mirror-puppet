---
classes:
  - apt::unattended_upgrades
  - govuk_apt::unused_kernels
  - gds_accounts
  - harden
  - puppet
  - ssh::server
  - ufw
  - gds_sudo
  - nginx
  - mirror_environment
  - mirror_environment::cron
  - mirror_environment::fail2ban
  - mirror_environment::firewall
  - mirror_environment::mounts
  - mirror_environment::user
  - mirror_environment::clamdscan
  - mirror_environment::supported_kernel
  - resolvconf
  - rssh
  - clamav

apt::unattended_upgrades::auto_reboot: true

puppet::puppet_ensure: '3.2.3-1puppetlabs1'
puppet::facter_ensure: '1.7.2-1puppetlabs1'
puppet::cron_command: '/opt/puppet/tools/puppet-apply --environment %{environment}'
puppet::cron_ensure: 'present'

mirror_environment::package_array:
  - lvm2
  - rsync
  - curl
  - update-notifier-common

rssh::users:
  - 'mirror-rsync:022:100000'

nginx::server_tokens: 'off'
nginx::confd_purge: true
nginx::http_cfg_append:
  gzip_vary: 'on'
nginx::nginx_vhosts:
  'www-origin':
    server_name:
      - 'www-origin.mirror.*'
    www_root: '/srv/mirror_data/www.gov.uk'
    listen_port: 443
    ssl:      true
    ssl_key:  '/etc/nginx/ssl/mirror.key'
    ssl_cert: '/etc/nginx/ssl/mirror.cert'
    ssl_protocols: 'TLSv1 TLSv1.1 TLSv1.2'
    location_cfg_prepend:
      expires: '15m'
      error_page: '403 500 503 504 =503 /error/503.html'
      rewrite: '^/(.*)/$ https://www.gov.uk/$1 permanent'
    try_files:
      - '$uri/index.html'
      - '$uri.html'
      - '$uri'
      - '=503'
  'assets-origin':
    server_name:
      - 'assets-origin.mirror.*'
    www_root: '/srv/mirror_data/assets.digital.cabinet-office.gov.uk'
    listen_port: 443
    ssl:  true
    ssl_key: '/etc/nginx/ssl/mirror.key'
    ssl_cert: '/etc/nginx/ssl/mirror.cert'
    ssl_protocols: 'TLSv1 TLSv1.1 TLSv1.2'
    location_cfg_prepend:
      expires: '15m'
      error_page: '403 500 503 504 =503 /error/503.html'
    try_files:
      - '$uri'
      - '=503'

nginx::nginx_locations:
  'canary':
    vhost: 'assets-origin'
    priority: 900
    location: /__canary__
    location_custom_cfg:
      - 'default_type text/plain'
      - 'add_header cache-control "max-age=0, no-store, no-cache"'
      - 'return 200 "OK\n"'

mirror_environment::supported_kernel::hwe_ver: 'trusty'

mirror_environment::mounts::mirror_data: '/srv/mirror_data'
mirror_environment::mounts::username: 'mirror-rsync'

mirror_environment::user::username: 'mirror-rsync'
mirror_environment::user::ssh_key: 'AAAAB3NzaC1yc2EAAAABIwAAAQEAw/ksvUhzrUVVbupDXEwz4J2K8Yz515pxhRLpfx6oGruM/hj4wVJ5uPt+4IL5k0sLXxRH0X/VXuK2zBV2fSnPP4cNUZiFrPbN1gea945dGvGIstLMZfsw8Md3jN4i8UXZFBriUfjQT7APLGEsQ+fl+Lzuhpp1nq2oWKem28moAxQkxU2ShPQhP/kzRkTrNbiusOFE4YQN4seZRJEtZ22p+qSVAPVyc2mfJHr6gdVNO3dMBdD7Ud9m3L5AeD7GNA/r2DiJViIplipRMvJJ0w3KkCnTWHiw3C0tXjyAMIH3jXqIJVqUej7Jum3FzixQrFgBR88XkPzlR0qHvR73HBSeZQ=='

gds_sudo::sudoers:
  group_sudo:
    users: '%sudo'
    tags:
      - 'NOPASSWD'

gds_accounts::groups:
  - gds
  - sudo

gds_accounts::accounts:
  alexmuller:
    comment: Alex Muller
    ssh_key: AAAAB3NzaC1yc2EAAAADAQABAAABAQDxuVkxqVy8kRncaG0cm/B8p7YTk7UjwE6xgUkfzIV97xAaRfNyZUI9Ur/w2x945r5IiuKGp61UHMzsGBEgmsDDNvukguY/a02yXZRySxf3ThlsqG/w7DX9uNwVEeLAA95es4P+6iApbRnBTQX7Nx/XsIa3hy8Uwr3T+pcrXCRIczhfuaiugQ/jh9IlkIC1I6UHbYoli8o5upTh9SbnimU/VXiUIO4v5z1CyLgQHfeE6VBxYO6HCQqRJg7uB4vNS5wAWyTYx4XinkS3ScjKmQr+wExyRy0vgnj5f+oVFNLgARh9lh2ViJ6ntGw8ww10b3xY/Bc/qoeFZKJjb89aMhLb
  alext:
    comment: Alex Tomlins
    ssh_key: AAAAB3NzaC1yc2EAAAADAQABAAABAQDEgfmhnlrUBF5i39bRssSJDaPvSxOn+cGUv2W+nliyExgbzxjIjE/qsbzPONyp1S1eBj2//EdLXR0ywzafNtLYG20dETF4RYGrULzww7RdX9KoJoLcujQy/T2+EbjcbuA+WXe9NLARSod3Sba+udFxV9uoVcVvHl659aVIKOe0I4iiu14XySn46NEXwmoL904bdqqc4FyBAYD1ch0uk2O5233TEwC32tQ4EENLTRsClYIGy2Pnq0h0gI8F031JMSuzYuum9CR4F1BkrrOJ+t7RJAy6rp8wuSrZM9Y6VLwMRHDbGStq3mNBZK4f7ZsIcaJwaCv2rtLYoZEmEjSQNVeP
  ajlanghorn:
    comment: Andrew Langhorn
    ssh_key: AAAAB3NzaC1yc2EAAAADAQABAAABAQDNRVe5iVIwcWJ4vxv4e1EgxuXelMYMbYop0TnzHmI2Kj/olA7x0eZy2nXIMQovjteGEu14exuDnWxXsZZA0yIcNKQKgX+WIcqsZX1hnzfVtX6+asLsolVn6OE+WalY3tYD6h2O94BYzYDnazARebdDC9tlAPxPFZG+TJYmgdHn/atzr9A5iEjFyprMYvf8JRxg1eP+uB/Zty6oy2jXyKAuPDjNEikkIFrSov2kHYvLSY5k10cI1sTjvU47yp7J/KmXlkAO4wfr0L+ffpRibUf85FnvLq3HG7ruXoYDMEX4NEB7xzE8D2Dn58mOIUuqIQio2YDRah7FByZHxR/85ntT
  annashipman:
    comment: Anna Shipman
    ssh_key: AAAAB3NzaC1yc2EAAAADAQABAAABAQDAuPt8UVjsxrbNUxy1v+Rmu+hq4bMAa7YAgAgyAuNrDq1G++RzLntZMiAELXWaxOrGNk738d6qpi/rMIyAY9l87woaA2/WRhFExkx2U5nnvLNItkxPKiOYHi1+LmQ++swb5zcg1P+TvkLPeNm95G61G1MxzEuROv/vAlk8IPPPWp08Qg+3vby7P0zyeu7KT8uwfSEIcXPxkofeMRXPiD4DSudYACEV5DB15YX37mlqu26QqyarTVCUMSvu916ejDSMeL/uE0aNYVAYSLmEbtat1MX0rZsnL+Z3F4UqkR6lmYHrK6++ZjeJ/TXAECdfH4uqdJlgfjXkQedg/LQFc9ZH
  bob:
    comment: bob walker
    ssh_key: AAAAB3NzaC1yc2EAAAADAQABAAABAQDEh7U1DlU9H1sWzzpuld/ifHPGTNJkawI/5UJmLWkZjkTbwtIMyoFi5QWtkloKVEQQCjCIHwW5+hgVzZmD63uXBYhQBJmQ2wuTlcyTIUhOtZ6RW8/nYmZm/Ty0hi1iYYKUrZRZFTxpt38VMk1VNEwYQ9BBK00GsJkExKktJLmGsmmC1wfoQrsl9bYwwkvenD9RreMVAO80pnPrvYxy9eJpXY3nC+MT7zIOLiN9XQ2BpBpGH5dLw2P/zRENDxv48GCz6bllTO21q5iRMgwwSfGh65mANHXDsHQgau/BnmSulFlcOczG5dhscT6GGG8yx2i9iiWuySbV2BfiuWjTzzq3
  bradleyw:
    comment: Bradley Wright
    ssh_key: AAAAB3NzaC1yc2EAAAADAQABAAABAQDF8hB/QZNnzh8f4L0l/dW5anGKNcS57SqbCF5cpkKSkTrcH57JKKr/jQOqLr4+bR/BK1ipBk1LpgC1wKNNFkiZRiq6XZ3mipJv/02RdanwkxKumqEoK5YibiL6kHN686Cr9HUe+CMon0Taiv8evd7je5nVrZBouBPrxOFNSdqVPpoajaTl7xUy13JL+2qRc4QLFhZoV6TPDp4iy2lMJ+x5VSolIPmY0j4/F+1sF//uDcM7HdByrq+2yjBiZGVrSBddMJmwjPWpScSvx5KixmpVx79poBE37gTeB0Dq7VJdDSBu+VEu0oWevvEOoJXXk6yG6L7LX1/uEpBeBC//KySX
  danielroseman:
    comment: Daniel Roseman
    ssh_key: AAAAB3NzaC1yc2EAAAADAQABAAABAQCbibke+QgHUIcq3GEyCWztjsp0g2JHaYi4ZLR2O/v12usHQQ2PtoynD+SC9fXfWxsjNChyXL9pBAx5sFo9iFZRWD6VeBh7pHkOGB1VN2/LDe9sjY/mgRrj3WtviLW6X4J3eXAthVh3462AZZ+xek/UFSWDgmFlfs94E2MtsTjd3HbCuXLGsUW1NtUgTYb7EloFTJuFfq0Ofohg3N3aR+sNDv64AAmMbSbiZol9GvwAHxPZDt85arG5JAP0Gd2sBwY39U4XlzeC7zPSzIbHFh4gKnqD5Pd3cqQdXCFkZyjlgpEuPfPaKos0HhiJcBSsGSHy1LWQmn6sx/NZPgCbRyKT
  dcarley:
    comment: Dan Carley
    ssh_key: AAAAB3NzaC1yc2EAAAADAQABAAABAQCd6wN5MjI+l8Ggjf5xhHT44L9LIGDR2dS65ovQcQ9VSTfnP3CMaF25ZyWsJ89Gu5UoO1BEbzkftMzFTjGAdWDFZ81QAl+3GGy2h3iQXtGvCKuC4Bl+OoaOQ0JuHySNXsMT/EyhzNHZN9SDPIOh7d/OERSYgO4RMSXv3SkYdD+18VSK9cztwloJYfs/2J1fYe+O4uGQd3NiGyiDvpIdR+bIn3Ct6T3Q/FgVXwrtbs9jxWw/LKAP6jYtwxdU4a8WcuijUS5oijW3iNKPMXwkxGJAH+J6fFbcAePfoheiehcbpa6dkshRWh2qG2px+T5V3HL7QVm70c2BTb/iA2MZOKop
  heathd:
    comment: David Heath
    ssh_key: AAAAB3NzaC1yc2EAAAABIwAAAQEAu0C17mT+R1TMyAA3E7EUEH38lYsnFqqgtFjJPpC44IL6Nt7AQbhr5FNGwgA/UubyoXPdhP89fvY4pYJ5CHvly1x4w0N2bmDCXCqIbuueTi6pbhj4/z/DbUfxOpLmXJrk7t3LDVAj5mbqN40dDbD+3+jYwjWOAavqUQ0YKoEH63EQV8L6lM2ukC4tF2MVToFqMVrdsMYuk6kXDyEYwpfw8cuwn8sBbnbNerKOpt/OL/i/D4dL97vUn7GL1PM+YVh6vavpxOfwanKCmRtwvncmyPQMY4whJiBBVRawF8WkukbgFsr72Cwnwjkm1JHjLHwRsuKhMU6RB/8JFj1i22+pqQ==
  jabley:
    comment: James Abley
    ssh_key: AAAAB3NzaC1yc2EAAAADAQABAAABAQC2568vUQp+Fb7bmSML5OHn0N8gmOjQp9LSE/HPh+xybMiX6ql8JhxDhPGl2NZl2zVmhICLlhY9HcX4E1w2mHY2MgSsoE148QPomYmcjkIkcQxh6nFN4Ga++foTu6WPkUQJudah3ML/XNs/D+yMgxk8nkel6EvIqgbbswlTQp22FmqGfk9XzJqX0mfTrlggJlacYlw+Z4JT4NhoFX4EefSSX0c6qm7fipX2U7M3hJUXxsakj0jM5GOk9xrEVCRUgx5M8l3rS2DwF0W54RewAdq5J9KdnIQi5DOsbVJKnR1flpoaIVuRq1x/feZ4yqi53ctYX5MT8tb6CLc8zmuU7XyR
  james:
    comment: James Stewart
    ssh_key: AAAAB3NzaC1yc2EAAAABIwAAAQEAqwZNyosGZJ4L5mU+jisfTMk+jU0rhhgfTLTRut6TQ/hvktRn5g70xSVZKUMLdxoxjxgYS+630TY3N9wimYzCuRJLLHM7Ieih+emM5SCrXeWLND2k2gxReTxIAv4qHHIEJLLTbywUMeKBBdHA7UXTDOI9j1k6bR6myQT60Iwh0bknL8tH3yLP/SWUcI82Lu6QNSnT3epEXjurKbdz1RvUW+bN1CFO9ARDnBZ001/MIOge2Q44RHWrGz/bvtD9guyXzK5s6HVQNzbApinUqvTby9gbuRtT0OBk6T01wAcXvmMLmp1+mKRmkrlBhTgW00xijeU3nH2eR+NeSrTrRDgWmQ==
  jamiec:
    comment: Jamie Cobbett
    ssh_key: AAAAB3NzaC1yc2EAAAADAQABAAABAQCocQlnao2aVxfTTz3LVI0DSezz8CiMl6Ewphky/D25+H9PbC9GiD95/kLw6+2AVaJ7eGS1xKCq5BKzfNT8hPSVKnIIkGgUf44BWFM3G1Y2GCQ3FDDVOTv0i7CJt3CZJ06oDkLyyXmt86J2kjQfFnSvzWKmI36OiGr7QFez61G7k+6SE/ZmDqZVeAs+qqmFG+X0HcRTsjt7/u38xWNqofNEJfRGfPnxo3Jemy0IKlp0a46Km57vHHsEpTe/iUQu9koA5mR5eyW2hoya/Y167DiloZS7Bh9Q6WE1GKwX+wj2v2PwgmbgxyqwbWoi60jzNggf/Wc3/6vX+Ie09j0aEqHD
  jennyduckett:
    comment: Jenny Duckett
    ssh_key: AAAAB3NzaC1yc2EAAAADAQABAAACAQDLK1FCyi1Sqiypd9lyNiuJLSuWws4WEYmg66QaZySZge2gHBfIdeTZsvaep9iklWL7OY8FzwxRGLPIwtLC0VwRuI75Cfvay4i86o5RzEKgEK8Fwy79EV1WZ5n1/AduPuWoS8CszJaLiNathTLicbfED6PmWecIjQVcr//+Q4CdjldvtSKSWasQstCq5KZnRzu2lpriHhIBS0wCFfOBs5tETUQ7NhJdFPH0AOLLrhM1qLA2P8uRn5dL9mVF7JseNoJI+d5xuODMQkCjnffqtktMi0xefRz/rohTe/JyQMcPOwzQi6GNeZobQS3lJBAksJFvfWtvGsYldmRzKBAKGF4szWJjY23H9RRm68157lxxcR0OZ82sabrC/4YX91YQmg0KzZRU5JtKTLRWNTWU1z4fXfjvJ0FtHWf9SaJ6/OAO3c3vLB46zNMcgaz/fz5spNr+59QwnHQU51K7Ucd7UAtXconreOFFwxBSPk6l7p7TeLVwvaEz1LJNUDMrPHmvAyaQJcce8H+FnhhjLsD1oi1Kocc2gQQPOCOIsd8tSkzXKLErRYCb1WZNWWDBlyzyT2pll2x60eOm965Tvkr97HYtTybhAfdhpxRpJxd5CijIr/7icRjiP9fdfGfGkdqI8oGWFHtY3kyOz3LvsbiGSsKuw0aAELm/XX7Z/7at6a+DNw==
  joshmyers:
    comment: Josh Myers
    ssh_key: AAAAB3NzaC1yc2EAAAADAQABAAABAQDeTQBwaWVnfdIektN4aAT4s3ZzOqqvC6ru4fnp85YizawjYXPOblzfBatUs4oQiDCbfIUTX9LqIR9qWb57VH3YVKSuJqdiRHiEO8MmlkFz0eQZDSCNnfXe41k+yJ3xAi+mAhK08xH6gY/psTJSG2l95fXLqVeCIgx8luc64BQYjA8xzYbBtnlDSQGQQbkU57QhpxnW/+EYQqUI4EDzKuIlNBCjtZuvNcdDavhBhLJjPD2xI2ddP7k7P30rLvh5kLUZjyuh00Bnh7/fu/AiSZzcpEVBn6ozDf//3XOWvZ4z1cVQjRkhrySoz1CET3J3hp6WHjG2vobRrTl3ReHZDKyD
  kushalp:
    comment: Kushal Pisavadia
    ssh_key: AAAAB3NzaC1yc2EAAAABIwAAAQEAtHtEBO3sARvNZj8F6Ugl4hlp5euXQkvle7Snvh9LhxL+6bJSAaeCSiRYXnqkGi0YpfaKiL3MrebrVILCcIsLsQk0RcTfah0PrRaHqfS7ABfSNYEg7D2/ISekXDvj0nvxIkSsapH/gqQtu9hR/LFUogvJS5WiMJZrlyvFTvkB/q7QqQXuv6MvqNeKf3NkVNKmYHmcf9OuRY46w2uQE18gPJmftUA6oBXpnT30EfIpn5/FFYBdjZY7IHG9EULS4GZXN7PZgIajSbZlNmrvLIYEcFzI90ekCuwonppqODcHSQajTvIu6G0WpqMyycSh0Q10whn4Dw683X2HrfwiSCChUw==
  mattbostock:
    comment: Matt Bostock
    ssh_key: AAAAB3NzaC1yc2EAAAADAQABAAACAQDeta2wY+w3jrzguXtyj/vrRX4RfFdutczT23HgdzyTXjK3Me/sI2s5Tw8RlF85PejupG4lVIivIeV/l77WxcCT5PArmmKyRBFLSqM9CzIpN52mxIQSorDpXoROqIYK1vyaAp+rsHRON3qWxzdKg41ignoPt8GUmMOZsZwjCLbiiDPqL9dkpUYmbdBzj8P7r8HamznLMIf4M/tZBeoOX4lDf6cK5DjEalGjPZSoWDdZVxzyf74iqFxisxjxPWjMjy8Jhe3Xq8MVrTjcz5c+J4zQiZsxffyWR57XXzyz79KhvcbJaGnmQwu8Vpr6txrPXDd8CUirRhMDEihpahdvIvnecDnXxJA85KfhCHSGSm9Sc1ukgObd+uLQcDRFYt2o78yLZWtz3HNK3wVL0sjhrfhl17/PD8BMQ6qkZGXb5B5toxYmts29UJIEV3PwSG1U6MUZe3KTm0y+LJnQzEpK9tUFZzlBBrRhrMfbMC027lZpOsHVPu/LBrrD9gcq330RgG7Uik2n1m9XcEjiSTkEc6rttZyJ00ZRl/KK1h/A2j6qA6y/vAxsaVgCzX8hvNOr+VDbBEgZUZiDq0DtZRO2xpjaFNfmju5JTvYIiLNktcdoXrXszRWDw6nWQByDw/ZvjoRNhD+EPcgAciB+gBuWJN/BfBvC0hJNI+uS24gx2svMsQ==
  richardboulton:
    comment: Richard Boulton
    ssh_key: AAAAB3NzaC1yc2EAAAADAQABAAACAQDEuWBYMxlI5YX5f07ddvlq5aIpc40zvozzFOI2ydA3lH3NGQPvHa9zoAn8vIPFKZ0d7x5Nc/8bczHdux5MvehVdyPbyGnKZOzAP1JTPhnFhuqTAR5GwpVsb1OMRclSJ5kTFS3tAuYwGKbK7CmjdatMdN7JBSfpVLdQooPieRRY48Gb1NNShjsUvJpvRJVSgg06JpJOAvH6Kp1k7y7U9OwyLHH2Z3avDRtbMbx6JWuQ5s+sbSPGTCrixiFjbEszJSSkXU1XP8h9ON0DANO5qd9eMU6vAksa4uocs3AIXX34O4FtxHOT9wkYjTFwDNdYTpJGe8QQbgVaVlyS+kKW+3q7xvemTMsQE+IiheH+/CxR6wypQ4Obx90D5UTk60F4u5SdgVEuyt0D2F+2azbFOEeOsU705MEhwI+DT10gqc3sJVv4SqPR5LNGSrqROx/gg7X0ukk4p78UrQu3pqZ40MAYyvpW44m/vMVz37LkETxmeRxa/TxKuiTvv893k/Ej00M9DxEUfgF2Q+/Rjfhw7gZlMLgB2WbMXks4APa3F2unliH9MjlCGg8UmQIpYD+Ov95PP14iCDEVrUhJUCSqV8fLHGDbZBjnLaAnAp55tjT+Z3HD3wL2RB/gNwvUsUIAAWn3EWynbntPWc+3fiND9i6B8QWI8ExKJLoA7Mo975/KOQ==
  robyoung:
    comment: Rob Young
    ssh_key: AAAAB3NzaC1yc2EAAAADAQABAAABAQDNSWWdnRGOEO0lfF0dwLwgdkgoXyRjpjQBEG2CtnccRctQUA+xMZ4Wf+RO4BLdevfKG3Ac7mlvuyM8VIU8n6zp+yvOf73eUJMbWAESqrzWer0KvoFtOZTvlOiKMFXxccI1nRxOn239nB3XBXqZQ5H02R10/vqOn6enAnPP47OCqtmwoO+tv4vh5D0rzmDekiiciy/u1ensQI5JrBHSB4QbNlTOufRqs+Kp7aGQSpif02ualkj8/FO/Onv8RWXnl2TtDfxU7LNi0aw/8h2RdZWxC8i52LtiJOiKLB6cwc6D9j7G4d90DL3Y2zY3OJOWR8JYrHgHz+iXR9l96XnJJ/z7
  timothymower:
    comment: Tim Mower
    ssh_key: AAAAB3NzaC1yc2EAAAADAQABAAABAQDLOQtMdIpjzTbSRYdFTvDOrCTYeS1N4NS+/hYP0BLoJTPXwYeIr8t1W2f1C7nS/CvUDF0n3rocmunjcGSa+9ZNUQbcEPjVngXs4xPbGTZMbaDMSXk2ov1cl1XG4t/kqkohXhNeYOTMOxzw7V7wfZSW72eIc/1a+cSbquUHULyN1MZRxrcBDqicyf/LVCHNuJklm1QIRxtrv7JaJSPHA03iXUT36QI8btGRxjJSikWjnN7Z9BKG0srNlK6ZPrTSD/8z0WGXfAUqhQU8G2aMOiJBAKWzGDYnLphWb1fLX1d/vWIAWiWO8aaaH+3AGRWGpnbw0uZ+CV4WbuDUwUBfiuhd
  tombooth:
    comment: Tom Booth
    ssh_key: AAAAB3NzaC1yc2EAAAADAQABAAABAQDNY4EOtJ+6Soa5161UXp3gb83FFEAGf6HIHAwjPCNQ1ivV6ErADW/nc8MGwNswlLsAszdRYkJTb9KQf+TTgqDq5suv5QdAd/H+gTk8sfxMJ6w2Phu9ru7WGIg7BnSGm/WKFtj3uoFRbaRrfAjsXMQUIZ24uuOq4OsjJi3iXerLbOaQm1BjqxFR+CYksdzzI73Kh+quHj8fELey1jvxPtos6zVK7tEJegxJBJPefs6qxG0RgHnQ4uzG9Ual/LITy5mRpNC6TpBMN0GC0SN207Zb84pLTS5aCquy6x3dAvWpINoeeIwgf+PhHXRZU1jCmpWk4lVqMI9NELfQI5u5ZoIR
